<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="main.css">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>    

    <title>CSC 642 848 Fall 2021 Individual Assignment Cameron Robinson Data survey form</title>
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
    <script src="https://www.google.com/recaptcha/api.js?onload=onloadCallback&render=explicit" async defer></script>
</head>
<body class="container">
<header>
</header>
<br>
<div style="text-align: center;">
    <h4>CSC 642 848 Fall 2021 Individual Assignment Cameron Robinson</h4>
    <h4>Data survey Form</h4>
</div>
<br>
<form action="results.html" method="post" class="form-validation"  novalidate>
    <div>
        <label for="AboutUser" class="col-form-label">About You</label>
        <div id="AboutUser" class="grouping">
            
            <div class="col-md-6 needs-validation">
                <label for="firstName" class="col-form-label">First Name <abbr class="required" title="required">*</abbr></label>
                <input type="text" id="firstName" class="form-control" placeholder="John" pattern=".{1,40}" required>
                <div class="invalid-feedback">
                    Please enter a valid first name.
                </div>
            </div>

            <div class="col-md-6 needs-validation">
                <label for="lastName" class="col-form-label">Last Name <abbr class="required" title="required">*</abbr></label>
                <input type="text" id="lastName" class="form-control" placeholder="Doe" pattern=".{1,40}" required>
                <div class="invalid-feedback">
                    Please enter a valid last name.
                </div>
            </div>

            <div class="col-md-6 needs-validation">
                <label for="emailAddress" class="col-form-label">E-Mail Address <abbr class="required" title="required">*</abbr></label>
                <input type="email" id="emailAddress" class="form-control" placeholder="johndoe@mail.com" required> 
                <div class="invalid-feedback">
                    Please enter a valid e-mail address.
                </div>
            </div>
            
            <div class="col-md-2 needs-validation">
                <label for="preferredTitle" class="col-form-label">Preferred Title <abbr class="required" title="required">*</abbr></label>
                <select id="preferredTitle" class="form-select" aria-label="Preferred Title" required>
                    <option selected value="">Select One</option>
                    <option value="None">None</option>
                    <option value="Student">Student</option>
                    <option value="Professor">Professor</option>
                    <option value="Staff">Staff</option>
                    <option value="Retired">Retired</option>
                </select>
                <div class="invalid-feedback">
                    Please select an option.
                </div>
            </div>

            <label for="userHeight" class="col-form-label">Your Height</label>
            <div id="userHeight" class="row g-2 align-items-center">
                <div class="col-auto">
                    <select id="heightFeet" class="form-select" aria-label="Height in feet">
                        <option selected value="">Feet</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                    </select>
                </div>
                <div class="col-auto">
                    <select id="heightInches" class="form-select"  aria-label="Height in inches">
                        <option selected value="">Inches</option>
                        <option value="0">0</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                        <option value="10">10</option>
                        <option value="11">11</option>
                    </select>
                </div>
            </div>

            <div class="col-md-3">
                <label for="phoneNumber" class="col-form-label">Phone Number</label>
                <input type="tel" id="phoneNumber" class="form-control" pattern="^\(?\d{3}\)?\s\d{3}-\d{4}\s*$" placeholder="(555) 555-5555">                
                <div id="phone-number-invalid-feedback" class="invalid-feedback">
                    Please enter a valid phone number.
                </div>
            </div>
        </div>

        <br>

        <label class="col-form-label">Address</label>
        <div class="grouping">
            <div class="col-md-6 needs-validation">
                <label for="address1" class="col-form-label">Address Line 1 <abbr class="required" title="required">*</abbr></label>
                <input type="text" class="form-control" id="address1" placeholder="1234 Doe Street" pattern=".{1,40}" required>
                <div class="invalid-feedback">
                    Please enter a valid address.
                </div>
            </div>
            <div class="col-md-6">
                <label for="address2" class="col-form-label">Address Line 2</label>
                <input type="text" class="form-control is-optional" id="address2" placeholder="Apt 123 (Optional)">
            </div>
            <div class="col-md-2 needs-validation">
                <label for="zipCode" class="col-form-label">Zip <abbr class="required" title="required">*</abbr></label>
                <input type="text" class="form-control" id="zipCode" pattern="[0-9]{5}" required>
                <div class="invalid-feedback">
                    Please enter a valid zip code.
                </div>
            </div>
        </div>

        <br>

        <label class="col-form-label">Service Options</label>
        <div class="grouping">
                
            <div>
                <label class="col-form-label">Services Required (Check all that apply)</label>
            </div>

            <input type="checkbox" id="email" name="e-mail" value="E-Mail">
            <label for="email">E-Mail</label><br>
            <input type="checkbox" id="phone" name="phone" value="Phone">
            <label for="phone">Phone</label><br>
            <input type="checkbox" id="facebook" name="Facebook" value="Facebook">
            <label for="facebook">Facebook</label><br>
            <input type="checkbox" id="twitter" name="Twitter" value="Twitter">
            <label for="twitter">Twitter</label><br>
            <input type="checkbox" id="surfaceMail" name="surface mail" value="Surface Mail">
            <label for="surfaceMail">Surface Mail</label><br>
            <input type="checkbox" id="personalVisit" name="personal visit" value="Personal Visit">
            <label for="personalVisit">Personal Visit</label>

            <div class="col-md-4">
                <hr>
            </div>


            <div>
                <label for="" class="col-form-label">Monthly Budget (Select one)</label>
            </div>

            <input type="radio" id="lt50" name="budget" value="lt50">
            <label for="lt50">Less than $50</label><br>
            <input type="radio" id="50-100" name="budget" value="50-100">
            <label for="50-100">$50 - $100</label><br>
            <input type="radio" id="gt100" name="budget" value="gt100">
            <label for="gt100">$100 or More</label>
        </div>

        <br>

        <div class="col-12">
            <div class="col-form-check needs-validation">
                <input class="form-check-input" type="checkbox" value="" id="termsAndConditions" required>
                <label class="form-check-label" for="termsAndConditions">
                I have read and agree to the website <abbr class="dummyLink" title="Dummy link">terms and conditions</abbr> <abbr class="required" title="required">*</abbr>
                </label>
                <div class="invalid-feedback">
                You must agree before submitting.
                </div>
            </div>
        </div>

        <br>

            <div id='html_element'></div>
            <div id="captcha-invalid-feedback" class="invalid-feedback">
                Please confirm you are not a robot.
            </div>

        <br>

        <div class="col-12">
        <button class="btn btn-primary" type="submit">Submit</button>
        </div>
    </div>
</form>
<br>
<br>
<br>

<main>
</main>

<footer>
</footer>

<script>
var captchaValid = true;
var captchaFeedbackDiv = null

var onloadCallback = function() {
        grecaptcha.render('html_element', {
            'sitekey' : '6LcODA4dAAAAAElzLcFHQwAw2ExVoo3wIzuCxmHg',
            'callback' : correctCaptcha
        });
    };

var correctCaptcha = function(response) {
    captchaValid = true;
    if(captchaFeedbackDiv !== null) {
        captchaFeedbackDiv.style.display = "none"
    }
    // alert(response);
};

function saveFormToStorage(form) {
    sessionStorage.setItem("firstName",       document.getElementById("firstName").value)
    sessionStorage.setItem("lastName",        document.getElementById("lastName").value)
    sessionStorage.setItem("emailAddress",    document.getElementById("emailAddress").value)
    sessionStorage.setItem("preferredTitle",  document.getElementById("preferredTitle").value)
    sessionStorage.setItem("heightFeet",      document.getElementById("heightFeet").value)
    sessionStorage.setItem("heightInches",    document.getElementById("heightInches").value)
    sessionStorage.setItem("phoneNumber",     document.getElementById("phoneNumber").value)
    sessionStorage.setItem("address1",        document.getElementById("address1").value)
    sessionStorage.setItem("address2",        document.getElementById("address2").value)
    sessionStorage.setItem("zipCode",         document.getElementById("zipCode").value)

    let serivces = [];
    
    let email = document.getElementById("email")
    if(email.checked) {
        serivces.push(email.value)
    }

    let phone = document.getElementById("phone")
    if(phone.checked) {
        serivces.push(phone.value)
    }

    let facebook = document.getElementById("facebook")
    if(facebook.checked) {
        serivces.push(facebook.value)
    }

    let twitter = document.getElementById("twitter")
    if(twitter.checked) {
        serivces.push(twitter.value)
    }

    let surfaceMail = document.getElementById("surfaceMail")
    if(surfaceMail.checked) {
        serivces.push(surfaceMail.value)
    }

    let personalVisit = document.getElementById("personalVisit")
    if(personalVisit.checked) {
        serivces.push(personalVisit.value)
    }

    sessionStorage.setItem("services", JSON.stringify(serivces))

    let budget = "Not Supplied";
    if(document.getElementById("lt50").checked) {
        budget = "Less than $50"
    }
    else if(document.getElementById("50-100").checked) {
        budget = "$50 - $100"
    }
    else if(document.getElementById("gt100").checked) {
        budget = "$100 or More"
    }
    sessionStorage.setItem("budget", budget)
}

// Basis of this function was taken from https://getbootstrap.com/docs/5.0/forms/validation/
// but modified for my purposes.
(function () {
    'use strict'

    // Get a list of all the divs that need validation. This is used to apply 
    // the special bootstrap validation popups only on required fields.
    let divs = document.querySelectorAll('.needs-validation')
    divs = Array.from(divs)

    // Get the invalid feedback error div for the captcha. Used to
    // display the error on form submission but can not be done through standard
    // bootstrap due to limitations with system.
    captchaFeedbackDiv = document.getElementById('captcha-invalid-feedback')

    // Get the phone number input field and invalid feedback div. Used to display
    // the error on form submission but because it is an optional value
    // do not want it to be displayed at all times. This will only appear 
    // if the form has data that does not fit the required type.
    let phoneNumberFeedback = document.getElementById('phone-number-invalid-feedback')
    let phoneNumberInput = document.getElementById('phoneNumber')

    // Creating phone number error closure.
    let checkPhoneNumberInput = () => {
        if(phoneNumberInput.checkValidity() === false) {
            phoneNumberFeedback.style.display = "block"
        }
        else {
            phoneNumberFeedback.style.display = "none"
        }
    }

    // Update the phone number error when the input field is changed.
    phoneNumberInput.addEventListener('change', (event) => {
        checkPhoneNumberInput()
    })

    // Fetch all the forms that need validation
    var forms = document.querySelectorAll('.form-validation')

    // Loop over the forms and prevent submission if fields are invalid
    Array.from(forms).forEach(function (form) {

        form.addEventListener('submit', function (event) {

            let submitting = true
            // If any one of the fields is invalid we stop the event.
            if (form.checkValidity() === false) {
                event.preventDefault()
                event.stopPropagation()
                submitting = false
            }
            
            if(captchaValid === false) {
                event.preventDefault()
                event.stopPropagation()

                captchaFeedbackDiv.style.display = "block"
                submitting = false;
            }

            if(submitting) {

                saveFormToStorage(form)
            }
            else {
                // We are not switching to the results page so update the 
                // divs to show which fields have errors.
                // For each required field we set its css tag to allow
                // for the bootstrap popups.
                divs.forEach(function (div) {
                    div.classList.add('was-validated')
                })
            }
        }, false)
    })
})()
</script>
</body>
</html>